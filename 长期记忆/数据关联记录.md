# 后端数据结构设计关键耦合逻辑说明

本文档梳理了前端原型中体现的五大核心数据耦合逻辑，旨在指导后端工程师设计数据结构。

## 1. 潜在供应商-合作-战略-黑名单供应商的数据链路

**业务逻辑：**
他们之间是有数据链路的。因为你可以勾选潜在供应商新增为合作供应商，勾选合作供应商为战略供应商。以此类推，这是一个层层递进或状态变更的过程。

**数据结构建议 (Data Dictionary & Schema)：**
*   **状态枚举 (Status Enum)**：
    *   `POTENTIAL` (潜在)
    *   `COOPERATIVE` (合作)
    *   `STRATEGIC` (战略)
    *   `BLACKLIST` (黑名单)
*   **链路继承 (Inheritance)**：
    *   建议使用同一个 `SupplierID`。当状态从 `POTENTIAL` 变为 `COOPERATIVE` 时，后端应保留原有的基础信息（联系人、初步沟通记录），并开放更多字段（如合同、财务信息）供录入。
    *   黑名单逻辑：当状态变为 `BLACKLIST` 时，应冻结其业务权限，但必须保留历史交易和绩效数据以供追溯。

## 2. 企业档案与动态日志的耦合

**业务逻辑：**
企业Profile（档案）里面，企业档案和动态日志是耦合的。逻辑是：从编辑动态日志的“全维信息”那里，可以直接修改企业档案。也就是说，日志是修改记录，也是更新档案的一个入口。

**数据结构建议 (Data Dictionary & Schema)：**
*   **写回机制 (Write-back Logic)**：
    *   API 接口 `POST /api/engagement-logs` 需支持复合数据提交。
    *   当日志中包含 `updated_contact_info` (联系人变更) 或 `updated_business_scope` (业务变更) 时，后端在保存日志的同时，必须同步更新 `Supplier_Profile` 表中的对应字段。
*   **版本控制**：
    *   建议在日志表中记录“修改了哪些档案字段”的快照，以便回溯档案变更历史。

## 3. 系统设置的配置化

**业务逻辑：**
系统设置里面“配载”了很多东西，这些配置直接体现在操作界面上。界面上的下拉框、选项都不是写死的，而是读取的系统设置。

**数据结构建议 (Data Dictionary & Schema)：**
*   **配置字典表 (System_Config / Dictionaries)**：
    *   `biz_types` (业务类型)：海运、空运、陆运等（支持增删改）。
    *   `payment_terms` (账期)：T+30, T+60, 预付等。
    *   `service_categories` (服务品类)：用于下拉筛选。
    *   `scoring_weights` (评分权重)：绩效打分时的各项占比配置。
*   **前端体现**：
    *   API `GET /api/system/configs` 应返回所有启用状态的配置项，前端渲染 Select/Dropdown 组件时动态加载这些数据。

## 4. 具体某个供应商拜访日历 vs 驾驶舱首页的全域日历

**业务逻辑：**
每个供应商详情页里的“拜访日历”，必须关联到首页的“全域日历”。首页日历是汇总视图。

**数据结构建议 (Data Dictionary & Schema)：**
*   **聚合查询 (Aggregation)**：
    *   数据实体应为 `Event` (事件) 或 `Visit_Plan` (拜访计划)。
    *   `Event` 表包含 `supplier_id` 外键。
    *   **首页日历接口**：`SELECT * FROM Events WHERE date BETWEEN start AND end` (不分供应商，查全部)。
    *   **详情页日历接口**：`SELECT * FROM Events WHERE supplier_id = ?` (只查特定供应商)。

## 5. 驾驶舱“我的任务”跳转具体操作界面

**业务逻辑：**
驾驶舱首页的【我的任务】列表，点击后可以跳转到具体的对应操作页面（不仅仅是跳到详情页，而是跳到具体的Tab或弹窗）。

**数据结构建议 (Data Dictionary & Schema)：**
*   **任务表设计 (Task Schema)**：
    *   `task_type`: 任务类型（如：资质审核、绩效评分、拜访录入）。
    *   `related_id`: 关联对象的ID（如 SupplierID）。
    *   `action_url` / `route_params`: 前端路由参数。
*   **跳转逻辑示例**：
    *   任务：【待审核：美森轮船】 -> 跳转至 `/supplier/123?tab=basic_info&action=verify`
    *   任务：【待评分：CMA CGM】 -> 跳转至 `/supplier/456?tab=performance&action=score_modal`
